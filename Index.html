<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ayush Dixit — Gamified 3D Portfolio</title>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />

<!-- GSAP for smooth animations -->
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Righteous&display=swap');


:root {
    --accent: #ff6347; /* Tomato Red */
    --accent-light: #fff0ed;
    --panel: rgba(255, 255, 255, 0.85);
    --text-dark: #333;
    --muted: #555;
    --border-color: rgba(0, 0, 0, 0.1);
    --sky-top-day: #87CEEB;
    --sky-bottom-day: #f0f8ff;
    --sky-top-night: #0c1445;
    --sky-bottom-night: #2d2d57;
}
*{box-sizing:border-box}
html,body{
    height:100%;
    margin:0;
    font-family:'Poppins',sans-serif;
    color: var(--text-dark);
    overflow:hidden;
    background: linear-gradient(180deg, var(--sky-top-day) 0%, var(--sky-bottom-day) 100%);
    transition: background 2s ease-in-out;
}
canvas{display:block;width:100vw;height:100vh}

/* NEW: Welcome Overlay */
#welcome-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    color: white;
    text-align: center;
    visibility: hidden; /* Initially hidden */
}
#welcome-text {
    font-family: 'Righteous', cursive;
    font-size: 5rem;
    padding: 0 20px;
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.5), 0 0 30px var(--accent);
}


/* UI Panels */
.ui-panel{
    position:absolute;
    background:var(--panel);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius:14px;
    padding:14px;
    border: 2px solid white;
    box-shadow:0 10px 30px rgba(0,0,0,0.12);
    color:var(--text-dark);
}
#loader{
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    font-weight:700;
    font-size:1.2rem;
    padding:16px 22px;
    z-index:50;
    background: white;
    border: 2px solid var(--accent);
}
#nav-menu{
    right:20px;
    top:24px;
    display:flex;
    flex-direction:column;
    gap:10px;
    padding:10px;
    z-index:40
}
.nav-btn{
    display:flex;
    align-items:center;
    gap:12px;
    padding:10px 16px;
    border-radius:12px;
    background: rgba(255,255,255,0.2);
    border:1px solid var(--border-color);
    cursor:pointer;
    color: var(--muted);
    font-weight:600;
    transition: all 0.25s ease-in-out;
}
.nav-btn i{
    width:22px;
    text-align:center;
    font-size: 1.2rem;
    color: var(--accent);
}
.nav-btn:hover{
    transform:translateY(-4px) scale(1.03);
    background: var(--accent-light);
    color:var(--accent);
    box-shadow: 0 6px 20px rgba(255, 99, 71, 0.2);
}
.nav-btn.active{
    background:var(--accent);
    color:white;
    box-shadow:0 10px 30px rgba(255, 99, 71, 0.3);
}
.nav-btn.active i { color: white; }

#hud{
    left:18px;
    bottom:18px;
    padding:12px 16px;
    border-radius:12px;
    font-weight:600;
    z-index:40
}
#hud .speed{
    font-size:1.4rem;
    font-weight: 700;
    letter-spacing:1px;
    color: var(--accent);
}
#interaction-prompt{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    bottom:20%;
    padding:12px 20px;
    border-radius:999px;
    display:none;
    z-index:40;
    font-weight: 600;
    font-size: 1.1rem;
    border: 2px solid white;
}
#info-panel{
    left:18px;
    top:50%;
    transform:translateY(-50%) translateX(-120%);
    width:420px;
    max-height:85vh;
    overflow:auto;
    border-left:5px solid var(--accent);
    z-index:50;
    visibility: hidden;
    opacity: 0;
    transition: transform 0.4s ease-out, opacity 0.4s ease-out, visibility 0.4s;
}
#info-panel.visible {
    transform: translateY(-50%) translateX(0);
    visibility: visible;
    opacity: 1;
}
#info-panel h2{margin:0 0 10px 0;color:var(--accent);font-size:1.6rem}
/* NEW: Profile picture styling */
#profile-pic {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 4px solid var(--accent);
    float: left;
    margin-right: 15px;
    margin-bottom: 5px;
    object-fit: cover;
}
#info-content details{
    background:rgba(0,0,0,0.02);
    margin-bottom:12px;
    padding:14px;
    border-radius:10px;
    border: 1px solid var(--border-color);
    clear: both; /* Fix for float issue */
}
#info-content summary{cursor:pointer;font-weight:700;outline: none;}
.close-btn{position:absolute;right:14px;top:12px;cursor:pointer;color:#aaa;font-size:26px;z-index:51; transition: transform 0.2s;}
.close-btn:hover { transform: scale(1.2); }

/* NEW: Contact links in About panel */
.contact-links {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 15px;
    clear: both; /* To handle the float from the profile pic */
}
.contact-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 15px 10px;
    background: var(--accent-light);
    border-radius: 12px;
    text-decoration: none;
    color: var(--accent);
    font-weight: 600;
    transition: all 0.25s ease;
}
.contact-link:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    background: var(--accent);
    color: white;
}
.contact-link i {
    font-size: 1.8rem;
    margin-bottom: 8px;
}
.contact-link span {
    font-size: 0.9rem;
}

/* NEW: Links for projects, research, etc. */
.item-links {
    display: flex;
    gap: 10px;
    margin-top: 12px;
}
.item-link-btn {
    flex-grow: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px;
    background: #f0f0f0;
    border-radius: 8px;
    text-decoration: none;
    color: var(--muted);
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.25s ease;
}
.item-link-btn:hover {
    background: var(--accent);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.item-link-btn i {
    font-size: 1.1rem;
}

#mobile-controls { display: none; } /* Hide mobile controls by default */

/* --- MOBILE RESPONSIVENESS --- */
@media (max-width:820px){
    #welcome-text { font-size: 3rem; }

    /* Info panel becomes a full-screen overlay */
    #info-panel{
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        max-height: 100vh;
        border-radius: 0;
        border-left: none;
        transform: translateY(-110%);
        padding: 45px 15px 15px 15px;
    }
    #info-panel.visible { 
        transform: translateY(0); 
    }
    .close-btn {
        top: 15px;
        right: 15px;
    }

    /* Bottom nav bar for mobile */
    #nav-menu{
        flex-direction: row;
        left:0;
        right:0;
        bottom:0;
        top:auto;
        justify-content: center;
        border-radius: 14px 14px 0 0;
        padding: 8px;
        overflow-x: auto;
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }
    #nav-menu::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
    }
    .nav-btn{
        padding:8px 12px;
        flex-shrink: 0; /* Prevent buttons from shrinking */
    }
    .nav-btn span {
        display: none; /* Hide text on mobile buttons, icons remain */
    }

    /* Hide desktop HUD and reposition interaction prompt */
    #hud{
       display: none;
    }
    #interaction-prompt {
        bottom: 90px;
        font-size: 1rem;
    }

    /* --- ON-SCREEN MOBILE CONTROLS --- */
    #mobile-controls {
        position: fixed;
        bottom: 15px;
        left: 15px;
        right: 15px;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        z-index: 60;
        pointer-events: none; /* Let clicks pass through the container */
    }

    .mc-dpad {
        position: relative;
        width: 120px;
        height: 120px;
    }

    .mc-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.5);
        border: 2px solid white;
        border-radius: 50%;
        color: var(--text-dark);
        font-size: 1.5rem;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        user-select: none;
        pointer-events: all;
        -webkit-tap-highlight-color: transparent;
    }

    .mc-btn:active {
        background: var(--accent);
        color: white;
    }

    #mc-up { top: 0; left: 50%; transform: translateX(-50%); }
    #mc-left { top: 50%; left: 0; transform: translateY(-50%); }
    #mc-down { bottom: 0; left: 50%; transform: translateX(-50%); }
    #mc-right { top: 50%; right: 0; transform: translateY(-50%); }

    #mc-interact {
        position: relative;
        width: 70px;
        height: 70px;
    }
}
.small{font-size:0.9rem;color:var(--muted)}
</style>
</head>
<body>

<!-- NEW: Welcome Overlay -->
<div id="welcome-overlay">
    <div id="welcome-text">Welcome to Ayush's World</div>
</div>

<div id="loader" class="ui-panel">Building Your World...</div>
<div id="nav-menu" class="ui-panel"></div>
<div id="hud" class="ui-panel">
    <div class="small">Controls: <span style="font-weight:700; color: var(--accent);">W A S D</span> • <span style="font-weight:700; color: var(--accent);">E</span> to interact</div>
</div>
<div id="interaction-prompt" class="ui-panel"></div>
<div id="info-panel" class="ui-panel">
    <span class="close-btn" title="Close">&times;</span>
    <div id="info-content"></div>
</div>
<!-- NEW: Mobile Controls -->
<div id="mobile-controls">
    <div class="mc-dpad">
        <button id="mc-up" class="mc-btn"><i class="fa-solid fa-arrow-up"></i></button>
        <button id="mc-left" class="mc-btn"><i class="fa-solid fa-arrow-left"></i></button>
        <button id="mc-down" class="mc-btn"><i class="fa-solid fa-arrow-down"></i></button>
        <button id="mc-right" class="mc-btn"><i class="fa-solid fa-arrow-right"></i></button>
    </div>
    <button id="mc-interact" class="mc-btn">E</button>
</div>

<!-- three.js import map -->
<script type="importmap">
{ "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
}}
</script>

<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { FontLoader } from 'three/addons/loaders/FontLoader.js';
import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';


const gsapGlobal = window.gsap || null;
const textureLoader = new THREE.TextureLoader();

/* ----- UPDATED: Resume Data with Achievements, Profile Pic, and Skills with Logos ----- */
const portfolioData = {
    "About": { 
        name: "AYUSH DIXIT", 
        title: "Final Year Undergraduate • Department of Civil Engineering • IIT Kanpur", 
        email: "dayush22@iitk.ac.in", 
        phone: "+91-8503878119", 
        linkedin: "https://www.linkedin.com/in/ayush-dixit-6b284125b/", 
        github: "https://github.com/dayush3104", 
        website: "https://ayush-dixit-portfolio.netlify.app/",
        // IMPORTANT: Add your profile picture URL here
        profilePicUrl: "Photo.jpg"
    },
    "Education": [{degree:"B.Tech.", institution:"Indian Institute of Technology Kanpur", year:"2022-Present", performance:"7.9/10.0"}, {degree:"Class XII (CBSE)", institution:"Apala School of Education, Nohar", year:"2021", performance:"95.4%"}, {degree:"Class X (CBSE)", institution:"Apala School of Education, Nohar", year:"2019", performance:"97.0%"}],
    "Work Experience": [{role:"Founder's Office Intern — Masai | Bengaluru", duration:"May'25 - Jul'25", description:"Honored with Masai's Best Team Award 2025.", points:["Programmed AI pipelines integrating PRAW & LLM APIs; automated sentiment analysis across 1,500+ discussions (90% reduction in manual monitoring).","Built analytics workflows in Python, SQL, Tableau & Google Data Studio; boosted YT impressions by 65% & CTR by 50%."]}, {role:"Core Team Member — Counselling Service, IIT Kanpur", duration:"Apr'24 - Apr'25", description:"Received Certificate Of Appreciation.", points:["Organized 10-day Orientation for 1250+ freshers, managed 15L+ budget.","Directed programs on Mental Health; impacted 10K+ students."]}],
    // NEW: Research Experience Section
    "Research Experience": [
        {
            role: "High-Fidelity Spatial Audio Modeling",
            duration: "Jan'25 - Apr'25",
            description: "Research Intern under Prof. Rajesh M. Hegde, in collaboration with <strong>Samsung R&D</strong>. Received 'A' Grade.",
            points: [
                "Engineered a 50+ hour, 4-Channel Spatial Audio Dataset (57 scenarios) with RIR Simulation and Convolution, validated via quantitative SNR metrics.",
                "Automated room acoustics modeling, convolving resampled signals into Multi-Channel Reverberant Audio for Samsung R&D datasets.",
                "Enhanced dataset integrity by resolving gain/loudness calibration issues, integrating Zero-padding, and ensuring 100% reproducibility with Python cross-validation.",
                "Built MATLAB simulation pipelines, reducing preprocessing time by 80% and minimizing hardware prototyping costs by 40%."
            ],
            links: { github: "https://github.com/dayush3104/High-Fidelity-Spatial-Audio-Modeling-for-Samsung-Smart-Glasses" }
        }
    ],
    "Projects": [{name:"CredTech — Credit Intelligence Platform", date:"Aug'25", description:"Top-8 Nationwide; Certificate of Excellence.", points:["Engineered credit risk intelligence integrating market returns, macro indices & news sentiment.","Improved predictive accuracy by 15–20% using LightGBM & time-series features."], links:{ github:"https://github.com/dayush3104/CredTech-Explainable-Credit-Intelligence-Platform", live:"https://dayush3104-credtech-explainable-credit-intelli-dashboard-rhy8rw.streamlit.app/"}}, {name:"High-Fidelity Spatial Audio Modeling", date:"Jan'25 - Apr'25", description:"Research with Samsung R&D. 'A' grade.", points:["Built 50+ hours, 4-channel spatial audio dataset with RIR simulation & convolution.","Automated room acoustics pipelines in MATLAB & Python."], links:{ github:"https://github.com/dayush3104/High-Fidelity-Spatial-Audio-Modeling-for-Samsung-Smart-Glasses" }}, {name:"Remote Sensing Classification Engine", date:"Feb'25 - Mar'25", description:"Course project (Prof. Onkar Dikshit).", points:["Gradio app using Sentinel-2; reduced annotation time by 60%.","Achieved 96.8% accuracy with optimized Random Forest."], links:{ github:"https://github.com/dayush3104/Land-Cover-Classification-and-Accuracy-Analysis" }}, {name:"Dynamic Inventory Platform", date:"Sep'24 - Oct'24", description:"MERN personal project.", points:["Built REST API with Node.js & MongoDB and a React SPA.","Token-based auth and component-driven React UI."], links:{ github:"https://github.com/dayush3104/Product-Management-System" }}],
    // NEW: Hackathon Section
    "Hackathons": [
        {
            name: "CredTech - Credit Intelligence Platform",
            date: "Aug'25",
            description: "Hosted by Deeproot Investments & Programming Club, IITK. Ranked in <strong>Top-8 Nationwide</strong> & awarded with <strong>Certificate of Excellence</strong>.",
            points: [
                "Engineered a Credit Risk Intelligence platform integrating market returns, macro indices, and news sentiment, generating issuer-level scores.",
                "Boosted predictive accuracy by 15–20% via advanced time-series features and optimized LightGBM models.",
                "Applied Explainable AI with SHAP to generate feature attributions for 100K+ predictions, reducing black-box opacity by 70%.",
                "Deployed a Sentiment Analysis Pipeline (FinBERT, VADER) on 5K+ financial articles, surfaced via a Streamlit Dashboard."
            ],
            links: { 
                github: "https://github.com/dayush3104/CredTech-Explainable-Credit-Intelligence-Platform",
                live: "https://dayush3104-credtech-explainable-credit-intelli-dashboard-rhy8rw.streamlit.app/"
            }
        }
    ],
    "Skills": {
        "Languages": [
            { name: "C++", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/cplusplus/cplusplus-original.svg" },
            { name: "Python", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/python/python-original.svg" },
            { name: "JavaScript", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/javascript/javascript-original.svg" },
            { name: "SQL", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/mysql/mysql-original-wordmark.svg" },
            { name: "MATLAB", logo: "https://upload.wikimedia.org/wikipedia/commons/2/21/Matlab_Logo.png" },
            { name: "HTML", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/html5/html5-original.svg" },
            { name: "CSS", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/css3/css3-original.svg" },
        ],
        "Software & Tools": [
            { name: "Jupyter", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/jupyter/jupyter-original-wordmark.svg" },
            { name: "VS Code", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/vscode/vscode-original.svg" },
            { name: "GitHub", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/github/github-original.svg" },
            { name: "MongoDB", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/mongodb/mongodb-original.svg" },
            { name: "QGIS", logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/QGIS_logo_new.svg/1200px-QGIS_logo_new.svg.png" }
        ],
        "Libraries & Frameworks": [
            { name: "TensorFlow", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/tensorflow/tensorflow-original.svg" },
            { name: "Scikit-Learn", logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Scikit_learn_logo_small.svg/2560px-Scikit_learn_logo_small.svg.png" },
            { name: "NumPy", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/numpy/numpy-original.svg" },
            { name: "Pandas", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/pandas/pandas-original.svg" },
            { name: "Node.js", logo: "https://raw.githubusercontent.com/devicons/devicon/master/icons/nodejs/nodejs-original.svg" },
        ]
    },
    // NEW: Detailed Achievements section
    "Achievements": [ 
        { text: "Achieved <strong>All India Rank 5893</strong> in JEE Advanced 2022, among 1.65 Lakh candidates.", year: "2022" },
        { text: "Secured <strong>All India Rank 6132</strong> in JEE Mains 2022, among 10.3 Lakh aspirants.", year: "2022" },
        { text: "Recognized as a <strong>National Semi-Finalist</strong> in the TATA Imagination Challenge, among 3.1 Lakh candidates.", year: "2024" },
        { text: "Emerged as a <strong>National Semi-Finalist</strong> in the Flipkart Grid 7.0 Challenge, outperforming a pool of 4 Lakh candidates.", year: "2025" },
        { text: "Distinguished among the <strong>Top 3,000</strong> of 50K+ applicants to join the Amazon Machine Learning Summer School.", year: "2025" },
        { text: "Secured a <strong>Top 8 Rank</strong> nationwide in the CredTech Hackathon.", year: "2025" },
        { text: "Achieved <strong>All India Rank 4</strong> in the Neural Sprint Competition, organized by IIM Rohtak.", year: "2025" },
        { text: "Shortlisted among <strong>Top 300</strong> of 9K+ teams for Round 2 of Accenture Strategy Connect.", year: "2024 & 2025" }
    ]
};

/* ----- Scene Variables ----- */
let scene, camera, renderer, clock, car = null;
let ambientLight, dirLight, sun;
const interactiveZones = [];
let canInteractWith = null;
let isAutoDriving = false;
let keys = { w:false, a:false, s:false, d:false };
let roadLineTexture;

const dom = { 
    loader: document.getElementById('loader'), 
    navMenu: document.getElementById('nav-menu'), 
    infoPanel: document.getElementById('info-panel'), 
    infoContent: document.getElementById('info-content'), 
    interactionPrompt: document.getElementById('interaction-prompt'), 
    closeBtn: document.querySelector('.close-btn'),
    welcomeOverlay: document.getElementById('welcome-overlay'),
    welcomeText: document.getElementById('welcome-text'),
    // NEW: Mobile Controls
    mobileControls: document.getElementById('mobile-controls'),
    mcUp: document.getElementById('mc-up'),
    mcDown: document.getElementById('mc-down'),
    mcLeft: document.getElementById('mc-left'),
    mcRight: document.getElementById('mc-right'),
    mcInteract: document.getElementById('mc-interact')
};

init();

function init(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);
    scene.fog = new THREE.Fog(0x87CEEB, 200, 1000);
    clock = new THREE.Clock();

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
    camera.position.set(0, 5, 15);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);
    
    setupLights();
    setupCartoonWorld();
    createCartoonCar();
    createStoppagesAndNav();
    createSkillsPark(); // REPLACES createSkillBillboards
    setupUI();
    setupEvents();
    
    // Animate everything after a short delay
    setTimeout(() => {
        dom.loader.style.display = 'none';
        createWelcomeAnimation();
        animate();
    }, 500);
}

// NEW: GSAP Welcome Animation
function createWelcomeAnimation() {
    dom.welcomeOverlay.style.visibility = 'visible';
    const tl = gsapGlobal.timeline({
        onComplete: () => {
            dom.welcomeOverlay.style.display = 'none';
        }
    });
    tl.from(dom.welcomeText, { duration: 1.5, y: -50, opacity: 0, ease: "bounce.out" })
      .to(dom.welcomeText, { duration: 1.5, opacity: 0, ease: "power1.in" }, "+=1.5");
}

function setupLights(){
    ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
    scene.add(ambientLight);
    dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
    dirLight.position.set(200, 250, 200);
    dirLight.castShadow = true;
    dirLight.shadow.mapSize.width = 2048;
    dirLight.shadow.mapSize.height = 2048;
    dirLight.shadow.camera.left = -300;
    dirLight.shadow.camera.right = 300;
    dirLight.shadow.camera.top = 300;
    dirLight.shadow.camera.bottom = -300;
    scene.add(dirLight);
}

function setupCartoonWorld() {
    // Ground
    const groundMat = new THREE.MeshLambertMaterial({ color: 0x5cb85c });
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(3000, 3000), groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    // Road
    const roadMat = new THREE.MeshLambertMaterial({ color: 0x4c4c4c });
    const road = new THREE.Mesh(new THREE.PlaneGeometry(25, 3000), roadMat);
    road.rotation.x = -Math.PI / 2;
    road.position.y = 0.01;
    road.receiveShadow = true;
    scene.add(road);

    // Animated Road Lines
    roadLineTexture = textureLoader.load('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAGCAYAAAACEPQxAAAAAXNSR0IArs4c6QAAABJJREFUCB1j+P//PwM26OanA5gAAPN9Av9N0QqLAAAAAElFTkSuQmCC');
    roadLineTexture.wrapS = THREE.RepeatWrapping;
    roadLineTexture.wrapT = THREE.RepeatWrapping;
    roadLineTexture.repeat.set(1, 500);
    const lineMat = new THREE.MeshBasicMaterial({ map: roadLineTexture, transparent: true });
    const line = new THREE.Mesh(new THREE.PlaneGeometry(0.5, 3000), lineMat);
    line.rotation.x = -Math.PI / 2;
    line.position.y = 0.02;
    scene.add(line);

    // Sun
    const sunMat = new THREE.MeshBasicMaterial({ color: 0xffdd33, toneMapped: false });
    sun = new THREE.Mesh(new THREE.SphereGeometry(50, 32, 32), sunMat);
    sun.position.set(-800, 400, -800);
    scene.add(sun);
    
    // Clouds
    const cloudMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
    for(let i=0; i<30; i++) {
        const cloud = new THREE.Group();
        const puff1 = new THREE.Mesh(new THREE.SphereGeometry(10 + Math.random() * 5, 8, 8), cloudMat);
        const puff2 = new THREE.Mesh(new THREE.SphereGeometry(15 + Math.random() * 8, 8, 8), cloudMat);
        puff2.position.set(10, -5, 5);
        const puff3 = new THREE.Mesh(new THREE.SphereGeometry(12 + Math.random() * 6, 8, 8), cloudMat);
        puff3.position.set(-12, -2, -2);
        cloud.add(puff1, puff2, puff3);
        cloud.position.set((Math.random() - 0.5) * 2000, 150 + Math.random() * 50, (Math.random() - 0.5) * 2000);
        scene.add(cloud);
    }
    
    // Trees and Rocks
    const trunkMat = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
    const leafMat = new THREE.MeshLambertMaterial({ color: 0x228B22 });
    const rockMat = new THREE.MeshLambertMaterial({ color: 0x8d8d8d });
    for(let i=0; i<150; i++) {
        const px = (Math.random() > 0.5 ? 1 : -1) * (20 + Math.random() * 200);
        const pz = (Math.random() - 0.5) * 3000;
        if(Math.random() > 0.3) { // Create a tree
            const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.7, 5, 8), trunkMat);
            trunk.castShadow = true;
            const leaves = new THREE.Mesh(new THREE.SphereGeometry(4 + Math.random() * 2, 8, 6), leafMat);
            leaves.castShadow = true;
            trunk.position.set(px, 2.5, pz);
            leaves.position.set(px, 7, pz);
            scene.add(trunk, leaves);
        } else { // Create a rock
            const rock = new THREE.Mesh(new THREE.DodecahedronGeometry(1.5 + Math.random() * 2, 0), rockMat);
            rock.castShadow = true;
            rock.position.set(px, 1, pz);
            rock.rotation.set(Math.random(), Math.random(), Math.random());
            scene.add(rock);
        }
    }
}

function createCartoonCar(){
    car = new THREE.Group();
    car.position.set(0, 0.7, 50); // Lowered slightly for bounce

    const carBodyMat = new THREE.MeshLambertMaterial({ color: 0xef4444 });
    const windowsMat = new THREE.MeshLambertMaterial({ color: 0xa1e0ff });
    const wheelMat = new THREE.MeshLambertMaterial({ color: 0x333333 });

    const body = new THREE.Mesh(new THREE.BoxGeometry(3, 1.5, 5.5), carBodyMat);
    body.position.y = 0.5;
    body.castShadow = true;

    const cabin = new THREE.Mesh(new THREE.BoxGeometry(2.5, 1.2, 3), windowsMat);
    cabin.position.set(0, 1.8, -0.5);

    const wheelGeo = new THREE.CylinderGeometry(0.7, 0.7, 0.5, 16);
    const wheels = [
        new THREE.Mesh(wheelGeo, wheelMat), new THREE.Mesh(wheelGeo, wheelMat),
        new THREE.Mesh(wheelGeo, wheelMat), new THREE.Mesh(wheelGeo, wheelMat)
    ];
    wheels[0].position.set(-1.6, 0, 2);
    wheels[1].position.set(1.6, 0, 2);
    wheels[2].position.set(-1.6, 0, -2);
    wheels[3].position.set(1.6, 0, -2);
    wheels.forEach(w => { w.rotation.z = Math.PI / 2; w.castShadow = true; car.add(w); });

    car.add(body, cabin);
    scene.add(car);
}

// REPLACES createSkillBillboards
function createSkillsPark() {
    const parkCenter = new THREE.Vector3(-80, 0, 150);
    const parkPlatformMat = new THREE.MeshLambertMaterial({ color: 0x78a082 });
    const parkPlatform = new THREE.Mesh(new THREE.CircleGeometry(60, 64), parkPlatformMat);
    parkPlatform.rotation.x = -Math.PI / 2;
    parkPlatform.position.copy(parkCenter).y = 0.05;
    parkPlatform.receiveShadow = true;
    scene.add(parkPlatform);

    // Add a central monument
    const monumentMat = new THREE.MeshLambertMaterial({ color: 0xffffff });
    const monument = new THREE.Mesh(new THREE.CylinderGeometry(2, 5, 15, 8), monumentMat);
    monument.position.copy(parkCenter).y = 7.5;
    monument.castShadow = true;
    scene.add(monument);
    gsapGlobal.to(monument.rotation, { y: Math.PI * 2, duration: 25, repeat: -1, ease: 'none' });


    let angle = 0;
    let radius = 15;
    const skills = portfolioData.Skills;

    for (const category in skills) {
        // Create a title for the category
        create3DText(category, parkCenter.clone().add(new THREE.Vector3(0, 12, -radius - 12)));

        skills[category].forEach(skill => {
            const logoMaterial = new THREE.MeshBasicMaterial({
                map: textureLoader.load(skill.logo),
                transparent: true,
                alphaTest: 0.5
            });
            const logoMesh = new THREE.Mesh(new THREE.PlaneGeometry(6, 6), logoMaterial);
            logoMesh.position.set(
                parkCenter.x + Math.sin(angle) * radius,
                5,
                parkCenter.z + Math.cos(angle) * radius
            );
            logoMesh.userData.isBillboard = true; // Flag for animation loop
            
            // Animate the logo
            gsapGlobal.to(logoMesh.position, { 
                y: 6, 
                duration: 2 + Math.random() * 1.5, 
                yoyo: true, 
                repeat: -1, 
                ease: 'sine.inOut' 
            });

            scene.add(logoMesh);
            angle += Math.PI / (skills[category].length / 2);
        });
        radius += 20; // Increase radius for the next category
        angle = 0; // Reset angle
    }
}

function create3DText(text, position) {
    const fontLoader = new FontLoader();
    fontLoader.load('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/fonts/helvetiker_bold.typeface.json', (font) => {
        const textGeo = new TextGeometry(text, {
            font: font,
            size: 4,
            height: 0.5,
        });
        const textMat = new THREE.MeshLambertMaterial({ color: 0xffffff });
        const textMesh = new THREE.Mesh(textGeo, textMat);
        textMesh.geometry.center();
        textMesh.position.copy(position);
        textMesh.castShadow = true;
        scene.add(textMesh);
        // Animate the text
        gsapGlobal.to(textMesh.rotation, { y: Math.PI * 2, duration: 40, repeat: -1, ease: 'none' });
    });
}


function createStoppagesAndNav() {
    const sections = [
        { name: "About", pos: new THREE.Vector3(30, 0, -600), icon: "fa-solid fa-user-tie" },
        { name: "Work Experience", pos: new THREE.Vector3(-30, 0, -400), icon: "fa-solid fa-briefcase" },
        { name: "Research Experience", pos: new THREE.Vector3(30, 0, -200), icon: "fa-solid fa-flask" },
        { name: "Projects", pos: new THREE.Vector3(-30, 0, 0), icon: "fa-solid fa-rocket" },
        { name: "Hackathons", pos: new THREE.Vector3(30, 0, 200), icon: "fa-solid fa-laptop-code" },
        { name: "Skills", pos: new THREE.Vector3(-80, 0, 350), icon: "fa-solid fa-star" },
        { name: "Education", pos: new THREE.Vector3(-30, 0, 450), icon: "fa-solid fa-graduation-cap" },
        { name: "Achievements", pos: new THREE.Vector3(30, 0, 600), icon: "fa-solid fa-trophy" }
    ];

    sections.forEach(s => {
        createStoppage(s.name, s.pos);
        createNavButton(s);
    });
}

function createStoppage(name, position) {
    const g = new THREE.Group();
    g.name = name;
    g.position.copy(position);

    // NEW: If the name is "Skills", we only create an invisible nav target, no visible object.
    if (name === 'Skills') {
        scene.add(g);
        interactiveZones.push(g);
        return; 
    }

    const baseMat = new THREE.MeshLambertMaterial({ color: 0xffffff });
    const base = new THREE.Mesh(new THREE.CylinderGeometry(12, 12, 0.5, 32), baseMat);
    base.receiveShadow = true;
    g.add(base);

    let themedObject;
    // ... (rest of the switch statement is unchanged, just added Achievements case)
    switch(name) {
        case "About":
            themedObject = new THREE.Mesh(new THREE.OctahedronGeometry(5, 0), new THREE.MeshLambertMaterial({color: 0x4285F4}));
            themedObject.position.y = 5;
            break;
        case "Work Experience":
            themedObject = new THREE.Mesh(new THREE.BoxGeometry(4, 8, 4), new THREE.MeshLambertMaterial({color: 0x34A853}));
            themedObject.position.y = 4;
            break;
        case "Projects":
            themedObject = new THREE.Mesh(new THREE.ConeGeometry(3, 8, 8), new THREE.MeshLambertMaterial({color: 0xEA4335}));
            themedObject.position.y = 4;
            break;
        case "Education":
            themedObject = new THREE.Mesh(new THREE.BoxGeometry(6,4,4), new THREE.MeshLambertMaterial({color: 0xFBBC05}));
            themedObject.position.y = 2;
            break;
        case "Achievements":
            themedObject = new THREE.Mesh(new THREE.TorusKnotGeometry(4, 1, 100, 16), new THREE.MeshLambertMaterial({color: 0xFFD700}));
            themedObject.position.y = 6;
            break;
        // NEW Cases for new sections
        case "Research Experience":
            themedObject = new THREE.Mesh(new THREE.IcosahedronGeometry(5, 0), new THREE.MeshLambertMaterial({ color: 0x9c27b0 })); // Purple color
            themedObject.position.y = 5;
            break;
        case "Hackathons":
            themedObject = new THREE.Mesh(new THREE.DodecahedronGeometry(5, 0), new THREE.MeshLambertMaterial({ color: 0x00bcd4 })); // Cyan color
            themedObject.position.y = 5;
            break;
    }
    themedObject.castShadow = true;
    g.add(themedObject);
    gsapGlobal.to(themedObject.rotation, { y: Math.PI * 2, x: Math.PI * 2, duration: 15, repeat: -1, ease: 'none' });
    
    
    const ring = new THREE.Mesh(new THREE.TorusGeometry(8, 0.3, 16, 100), new THREE.MeshBasicMaterial({ color: 0xff6347 }));
    ring.rotation.x = Math.PI / 2;
    ring.position.y = 1;
    g.add(ring);
    gsapGlobal.to(ring.rotation, { z: Math.PI * 2, duration: 10, repeat: -1, ease: 'none' });
    
    scene.add(g);
    interactiveZones.push(g);
}


function createNavButton(section){
    const btn = document.createElement('button'); btn.className='nav-btn';
    btn.innerHTML = `<i class="${section.icon}"></i><span>${section.name}</span>`;
    btn.onclick = ()=> navTo(section.name);
    dom.navMenu.appendChild(btn);
}

function navTo(sectionName){
    if(!car) return;
    isAutoDriving = true; keys = { w:false,a:false,s:false,d:false };
    const zone = interactiveZones.find(z => z.name === sectionName); if(!zone) return;
    document.querySelectorAll('#nav-menu .nav-btn').forEach(b => b.classList.toggle('active', b.textContent.trim().includes(sectionName)));
    
    const targetPos = zone.position.clone();
    
    // For regular stoppages, stop in front. For Skills, go to the exact nav point.
    if (sectionName !== 'Skills') {
        targetPos.add(new THREE.Vector3(0, 0, 25));
    }
     
    const lookAtPos = zone.position.clone();
    
    const temp = new THREE.Object3D(); temp.position.copy(car.position); temp.lookAt(lookAtPos);
    const targetQuat = temp.quaternion.clone();

    const distance = car.position.distanceTo(targetPos);
    
    if(gsapGlobal){
        gsapGlobal.timeline({ onComplete: ()=> { isAutoDriving=false; displayInfo(sectionName); document.querySelectorAll('#nav-menu .nav-btn').forEach(b => b.classList.remove('active')); } })
        .to(car.position, { x: targetPos.x, y: car.position.y, z: targetPos.z, duration: Math.max(1, distance/50), ease:'power2.inOut' })
        .to(car.quaternion, { x: targetQuat.x, y: targetQuat.y, z: targetQuat.z, w: targetQuat.w, duration:1.5, ease:'power2.inOut' }, "<");
    }
}

function setupUI(){
    dom.infoContent.innerHTML = `<h2>Welcome to my Portfolio Adventure!</h2><p class="small">Use the nav menu or drive the car to explore different areas. Get close to an island and press <strong>E</strong> to learn more about my skills, projects, and experience.</p>`;
}

function setupEvents(){
    window.addEventListener('resize', ()=> { 
        camera.aspect = window.innerWidth/window.innerHeight; 
        camera.updateProjectionMatrix(); 
        renderer.setSize(window.innerWidth, window.innerHeight); 
    });

    const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

    if (isTouchDevice) {
        setupMobileControls();
    } else {
        window.addEventListener('keydown', (e) => {
            if(isAutoDriving) return;
            const k = e.key.toLowerCase();
            if(['w','a','s','d'].includes(k)) keys[k]=true;
            if((e.key==='e' || e.key==='E') && canInteractWith) displayInfo(canInteractWith.name);
        });
        window.addEventListener('keyup', (e) => { const k = e.key.toLowerCase(); if(['w','a','s','d'].includes(k)) keys[k]=false; });
    }

    dom.closeBtn.addEventListener('click', ()=> { dom.infoPanel.classList.remove('visible'); });
}

// NEW: Function to handle mobile touch controls
function setupMobileControls() {
    dom.mobileControls.style.display = 'flex';

    const buttonMap = [
        { btn: dom.mcUp, key: 'w' },
        { btn: dom.mcDown, key: 's' },
        { btn: dom.mcLeft, key: 'a' },
        { btn: dom.mcRight, key: 'd' },
    ];

    buttonMap.forEach(item => {
        item.btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if(isAutoDriving) return;
            keys[item.key] = true;
        }, { passive: false });
        item.btn.addEventListener('touchend', (e) => {
            e.preventDefault();
            keys[item.key] = false;
        }, { passive: false });
    });

    dom.mcInteract.addEventListener('touchstart', (e) => {
        e.preventDefault();
        if (canInteractWith) {
            displayInfo(canInteractWith.name);
        }
    }, { passive: false });
}

function displayInfo(name){
    let html = `<h2>${name}</h2>`;
    const data = portfolioData[name];
    if(!data){ html += `<p>No data available.</p>`; dom.infoContent.innerHTML = html; dom.infoPanel.classList.add('visible'); return; }

    if(name === 'About'){
        html += `<img id="profile-pic" src="${data.profilePicUrl}" alt="Ayush Dixit" onerror="this.style.display='none'"/>`;
        html += `<p style="padding-top:10px;"><strong>${data.name}</strong><br/><span class="small">${data.title}</span></p>`;
        html += `<div class="contact-links">`;
        html += `    <a href="mailto:${data.email}" class="contact-link" target="_blank"><i class="fa-solid fa-envelope"></i><span>Email</span></a>`;
        html += `    <a href="tel:${data.phone}" class="contact-link"><i class="fa-solid fa-phone"></i><span>Call</span></a>`;
        html += `    <a href="${data.linkedin}" class="contact-link" target="_blank"><i class="fa-brands fa-linkedin"></i><span>LinkedIn</span></a>`;
        html += `    <a href="${data.github}" class="contact-link" target="_blank"><i class="fa-brands fa-github"></i><span>GitHub</span></a>`;
        html += `</div>`;
    } else if(Array.isArray(data)){
        // UPDATED: Handle new achievements format
        if (name === 'Achievements') {
            data.forEach(item => {
                html += `<details><summary>${item.text}</summary>`;
                html += `<p><strong>Year:</strong> ${item.year}</p>`;
                html += `</details>`;
            });
        } else {
            data.forEach(item => {
                const title = item.degree || item.role || item.name || 'Item';
                html += `<details><summary>${title}${item.institution? ' — ' + item.institution : ''}${item.company? ' — '+item.company: ''}${item.date? ' ('+item.date+')': ''}${item.duration? ' ('+item.duration+')' : ''}</summary>`;
                if(item.description) html += `<p class="small" style="margin-top: 8px;"><em>${item.description}</em></p>`;
                if(item.performance) html += `<p><strong>Performance:</strong> ${item.performance}</p>`;
                if(item.points) html += `<ul>${item.points.map(p=>`<li>${p}</li>`).join('')}</ul>`;
                
                // UPDATED: Link generation
                if (item.links) {
                    html += `<div class="item-links">`;
                    if (item.links.github) {
                        html += `<a href="${item.links.github}" target="_blank" class="item-link-btn"><i class="fa-brands fa-github"></i> GitHub</a>`;
                    }
                    if (item.links.live) {
                        html += `<a href="${item.links.live}" target="_blank" class="item-link-btn"><i class="fa-solid fa-external-link-alt"></i> Live Demo</a>`;
                    }
                    html += `</div>`;
                }

                html += `</details>`;
            });
        }
    } else if(name === 'Skills') {
        html += `<h2>Skills Park</h2><p>Welcome to the Skills Park! Drive around this area to see my technical abilities. You can also navigate to other sections using the menu.</p>`;
    } else {
        html += `<p>${String(data)}</p>`;
    }
    
    dom.infoContent.innerHTML = html; 
    dom.infoPanel.classList.add('visible');
}

function checkInteractions(){
    if(!car) return;
    let closest = null, minD = 35;
    interactiveZones.forEach(z => {
        // Don't show interaction prompt for the invisible 'Skills' nav point
        if (z.name === 'Skills' && car.position.distanceTo(z.position) < 30) {
            return;
        }
        const d = car.position.distanceTo(z.position);
        if(d < minD){ minD = d; closest = z; }
    });
    if(closest && closest !== canInteractWith){
        canInteractWith = closest;
        dom.interactionPrompt.innerHTML = `<strong style="background:var(--accent);color:white;padding:8px 12px;border-radius:8px;margin-right:10px">E</strong> Visit ${canInteractWith.name}`;
        dom.interactionPrompt.style.display = 'block';
        if(gsapGlobal) gsapGlobal.fromTo(dom.interactionPrompt, {scale:0.8, opacity:0}, {scale:1, opacity:1, duration:0.3});
    } else if(!closest && canInteractWith){
        canInteractWith = null; 
        if(gsapGlobal) gsapGlobal.to(dom.interactionPrompt, {scale:0.8, opacity:0, duration:0.2, onComplete: () => dom.interactionPrompt.style.display = 'none'});
    }
}

function updateCar(dt){
    if(!car || isAutoDriving) return;
    if(typeof car.userData.speed === 'undefined') car.userData.speed = 0;
    if(typeof car.userData.turn === 'undefined') car.userData.turn = 0;

    const accel = 120, decel = 80, max = 200;
    if(keys.w) car.userData.speed = Math.min(max, car.userData.speed + accel*dt);
    else if(keys.s) car.userData.speed = Math.max(-max/2, car.userData.speed - accel*dt);
    else {
        if (car.userData.speed > 0) car.userData.speed = Math.max(0, car.userData.speed - decel*dt);
        else car.userData.speed = Math.min(0, car.userData.speed + decel*dt);
    }

    if(keys.a) car.userData.turn = Math.min(1.2, car.userData.turn + 3*dt);
    else if(keys.d) car.userData.turn = Math.max(-1.2, car.userData.turn - 3*dt);
    else car.userData.turn *= (1 - dt * 4);

    const speedFactor = Math.abs(car.userData.speed)/max;
    car.rotation.y += car.userData.turn * dt * speedFactor * 0.7;
    car.translateZ(-car.userData.speed * dt * 0.05);

    // NEW: Car bounce for more dynamic feel
    const bounceFrequency = 15;
    const bounceAmplitude = 0.05;
    if (Math.abs(car.userData.speed) > 5) {
        car.position.y = 0.7 + Math.sin(clock.getElapsedTime() * bounceFrequency * speedFactor) * bounceAmplitude;
    }


    car.children.filter(c => c.geometry.type === 'CylinderGeometry').forEach(w => {
        w.rotation.x -= (car.userData.speed * dt * 0.03);
    });
    
    if(roadLineTexture) roadLineTexture.offset.y -= (car.userData.speed * dt * 0.001);
}

function updateCamera(){
    if(!car) return;

    // NEW: Adaptive camera for mobile
    const isMobile = window.innerWidth < 820;
    const offsetDistance = isMobile ? 18 : 12;
    const offsetHeight = isMobile ? 7 : 4;

    const offset = new THREE.Vector3(0, offsetHeight, offsetDistance).applyQuaternion(car.quaternion);
    const desired = car.position.clone().add(offset);
    camera.position.lerp(desired, 0.08);
    camera.lookAt(car.position.clone().add(new THREE.Vector3(0, 2, 0)));
}


function animate(){
    requestAnimationFrame(animate);
    const dt = Math.min(0.05, clock.getDelta());
    
    updateCar(dt);
    updateCamera();
    checkInteractions();

    // Make skill logos always face the camera
    scene.children.forEach(child => {
        if (child.userData.isBillboard) {
            child.quaternion.copy(camera.quaternion);
        }
    });

    renderer.render(scene, camera);
}
</script>
</body>
</html>

